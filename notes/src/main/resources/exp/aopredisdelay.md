# SpringBoot AOP + Redis 延时双删功能实战

## 方案介绍
保持数据库和Redis缓冲一致的一个方案
在使用Redis时，需要保持Redis和数据库数据的一致性，最流行的解决方案之一就是延时双删策略。

>注意：要知道经常修改的数据表不适合使用Redis，
> 因为双删策略执行的结果是把Redis中保存的那条数据删除了，
> 以后的查询就都会去查询数据库。所以Redis使用的是读远远大于改的数据缓存。

## 步骤
1. 删除缓存
2. 更新数据库
3. 延时500毫秒 (根据具体业务设置延时执行的时间)
4. 删除缓存

## 问题
1. 为何要延时500毫秒？
   <br>第二次删除Redis之前能完成数据库的更新操作。
    假象一下，如果没有第三步操作时，有很大概率，在两次删除Redis操作执行完毕之后，
    数据库的数据还没有更新，此时若有请求访问数据，就会请求到旧的数据
2. 为何要两次删除缓存？
   没有第二次删除操作，此时有请求访问数据，
   有可能是访问的之前未做修改的Redis数据，
   删除操作执行后，Redis为空，有请求进来时，
   便会去访问数据库，此时数据库中的数据已是更新后的数据，保证了数据的一致性。
# REF

[延时双删功能实战](https://mp.weixin.qq.com/s/GqDDaQ9cO2qXS2qM6q_xxg)